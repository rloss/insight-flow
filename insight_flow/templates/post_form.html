{% extends "base.html" %}
{% block title %}{{ mode == "edit" and "ê¸€ ìˆ˜ì •í•˜ê¸°" or "ê¸€ì“°ê¸°" }} - Insight Flow{% endblock %}

{% block content %}
  <h2>{{ mode == "edit" and "âœ ê¸€ ìˆ˜ì •í•˜ê¸°" or "ğŸ“ ì¸ì‚¬ì´íŠ¸ ì‘ì„±í•˜ê¸°" }}</h2>

  <!-- Quill CSS CDN -->
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

  <form method="POST" style="display: flex; flex-direction: column; gap: 1rem; max-width: 700px;">
    <input type="text" name="title" placeholder="ì œëª©" value="{{ post.title if post else '' }}" required />

    <!-- ì—ë””í„° ì˜ì—­ -->
    <div id="editor" style="height: 300px; background: #fff;">
      {{ post.content|safe if post else '' }}
    </div>
    <input type="hidden" name="content" id="hidden-content" />

    <input type="text" name="author" placeholder="ì‘ì„±ì" value="{{ post.author if post else '' }}" />

    <div>
      <label>ì¹´í…Œê³ ë¦¬ (ë³µìˆ˜ ì„ íƒ)</label><br />
      {% for cat in categories %}
        <label>
          <input type="checkbox" name="categories" value="{{ cat }}"
                 {% if post and cat in post.categories %}checked{% endif %}>
          {{ cat }}
        </label>
      {% endfor %}
    </div>

    <input type="text" name="tags" placeholder="íƒœê·¸ (ì‰¼í‘œ êµ¬ë¶„)" value="{{ post.tags if post else '' }}" />

    <button type="submit">{{ mode == "edit" and "ìˆ˜ì • ì™„ë£Œ" or "ì‘ì„± ì™„ë£Œ" }}</button>
  </form>

  <!-- Quill JS CDN -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

  <script>
    const quill = new Quill('#editor', {
      theme: 'snow',
      placeholder: 'ë‚´ìš©ì„ ì‘ì„±í•´ ì£¼ì„¸ìš”...',
      modules: {
        toolbar: [
          [{ header: [1, 2, 3, false] }],
          ['bold', 'italic', 'underline'],
          [{ list: 'ordered' }, { list: 'bullet' }],
          ['link', 'blockquote', 'code-block'],
          ['clean']
        ]
      }
    });

    // ê¸°ì¡´ content ë¶ˆëŸ¬ì˜¤ê¸° (ìˆ˜ì • ì‹œ í•„ìš”)
    const hiddenContent = document.getElementById("hidden-content");

    // form submit ì‹œ content ê°’ ì„¸íŒ…
    document.querySelector("form").addEventListener("submit", function () {
      hiddenContent.value = quill.root.innerHTML;
    });
  </script>
{% endblock %}

